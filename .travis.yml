language: ruby
rvm:
  - 1.9.3
env:
  global:
    # These variables need to be changed for personalized deployment
    # See README for details
    - secure: "YZLEEev+JQoqlThsreCS0Px3LPMgQJX8BCquS7jsXsBG5FZba00tEdhviL5Z\nQurx5rsO0YS6dW3PA1yl+H+npro4FBpfMTV0tU+FrfO19h08Gro7cBwTxqlI\nOp0Zje4u/e4lMA1NQFcM+z/SUqr7tWkFraXb+AWby9ZQQG7Klm8="
    - secure: "T1wvWm84s5OdDk6PzYmteboEnaGLWiOW1qvoIjwg3PXByZXcDsb3I8Kp9Sg3\nk5EoUmZyrWSlIvpTgyPP2eyncnn6IktB1Qa5sllbS/g/XP1MqGl6pJtsEDnm\n/ongBWdg6pzQKAeAcN4puQzXWu69F2AnaCJroTKrNaMmI/Y1uJw="
    # - secure: "no/EIYkKUaHn8E4joAoPkcjwGs/3DdOdt5NwjEI8TzIRXO2qofT8I/n1IRuv\ntHILoVgkn3K0TOQOq/bm+k+AV5ALQNkdsX1WYmdlgLLIIJLYeVWngXWx/5vr\nIGD+KXOWPsH7IZkCvYmxVTxtQ4cYTxuOv9hJd8CtNmHPxUbKdwA="
    - secure: "oONlDhsIFQosKC/hRAOV6qK23ZFJKV0B601susfwbbliG7pahk03GfbbAIUL\nwcyv8Uw9T6WJQakhMUSSRFGCTecIvh6uVZyAapMvWhJc5n6U6RjeSkIIyDF0\ntxn8734iJaYPF3I047gRaiYFir/eHtej9AHZmLB9zARV7y1a7YQ="
    # - secure: "HP6yVsrQs52HgpH6nXMzRpD4oqL+RzdYyyQQifdu03vlK+7qdAfd0lseH/m7\nMDIGNil0ZIf/yODWrL4Qo4vFbX1ZMx3Cv/2MqWh6XbaX+i9wn3SX1Y1Jmupj\ngZc9QtyYxRN0ylDUs01s2/kv8dZjRvd+5DobRw0JbSKRg8+2ea4="
    - secure: "W4P+RYtrMi1r+XR9sYrFMImHHVRjeTznprNTGwrh2hgOWgxHopGt3oMqXXkg\ndnNjgub/de14qR0jYvTm/1vB3NSU0n1AE8LN8DMgE+mXEgAHEQNh0R9IWpNb\nQHi1nwPfzATqGcHY70bmueO7x4L3hhfHhsX41NkAvHW4GHZ+KKs="
    # - secure: "GvE31eHzRLzPJlp5OGvkIrMNzhj8wY1e0h1L21INxeBdhnxO7Notaw5W9Aa5\nf6U1VxkCOI7H3yPvHGwurCG9p5tdLGdLfy/0G43/4uZP10bXerK6UPpBawBz\nRxIXw/rPyED/czSN7ZmLSvE1N4vZtDWgO7w9fl+1glXh66IPytw="
    - secure: "At4e9KWD71poVqmWMVqRj7OPoELDLFvSez8VnA/t5PAUV5+72ndv2l+qZp26\nyCNwRYUBqTqdDWxpO8/lHlsNe3flfIkQFLmXCP99lniDg7f02cA2aenB7X5G\nQcefEhNR4d23L45pehzFUmSAGgp10ZOyNGkIFC5ZAdQpO9Axayo="
  matrix:
    - DB: postgresql
bundler_args: --binstubs=./bundler_stubs --without development
before_script:
  - psql -c "create database $DB_NAME;" -U $DB_USER
  - RAILS_ENV=test bundle exec rake db:migrate --trace
script:
  - bundle exec rspec --no-drb --format progress spec/
after_success:
  # heroku labs:enable user-env-compile -a [app-name]
  # enabled so no need to precompile assets before deploy anymore
  # - bundle exec rake assets:precompile
  # - git add public/assets
  # - git commit -m "Precompile assets"
  - gem install heroku
  - git remote add heroku $HEROKU_GIT_URL
  # Turn off warnings about SSH keys:
  - echo "Host heroku.com" >> ~/.ssh/config
  - echo "   StrictHostKeyChecking no" >> ~/.ssh/config
  - echo "   CheckHostIP no" >> ~/.ssh/config
  - echo "   UserKnownHostsFile=/dev/null" >> ~/.ssh/config
  # Clear current Heroku SSH keys
  - heroku keys:clear
  # Add a new SSH key to Heroku
  - yes | heroku keys:add
  - yes | git push heroku master